[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Address",
  "enabled": 0,
  "modified": "2021-07-14 12:27:08.273767",
  "name": "Address-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Address', {\n  onload(frm) {\n\t\tcheck_customer(frm);\n\t},refresh(frm) {\n\t\tcheck_customer(frm);\n\t},\n  validate(frm){\n    check_customer(frm);\n  }\n\n});\n\nvar check_customer = function(frm){\n  $.each(frm.doc.links || [], function(i, v) {\n    console.log(\"test1\");\n    frappe.call({\n         method: 'frappe.client.get',\n         args: {\n             'doctype': 'Customer',\n             'filters': {'name': v.link_name}\n         },\n         callback: function(r){\n            if(r.message.customer_type == \"Business\"){\n              frm.set_df_property('tax_category', 'reqd', 1);\n              frm.set_df_property('gstin', 'reqd', 1);\n              frm.set_df_property('gst_state', 'reqd', 1);\n              frm.set_df_property('gst_state_number', 'reqd', 1);\n              frm.refresh_field('tax_category');\n              frm.refresh_field('gstin');\n              frm.refresh_field('gst_state_number');\n              frm.refresh_field('gst_state');\n            }\n         }\n    });\n  });\n};\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item Price",
  "enabled": 1,
  "modified": "2021-08-17 16:38:26.371007",
  "name": "Item Price-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Item Price', {\n\tvalidate(frm) {\n\t\tif(frm.doc.price_list_2!==\"\"){\n\t\t    if(frm.doc.price_list_2==\"Price To Franchaisee - (PTF)\"){\n\t\t        msgprint(\"Price List 2 Added Successfully\");\n\t\t    }\n\t\t}\n\t\tif(frm.doc.price_list_3!==\"\"){\n\t\t    if(frm.doc.price_list_3==\"Price To Customer - (PTC)\"){\n\t\t        msgprint(\"Price List 3 Added Successfully\");\n\t\t    }\n\t\t}\n\t},\n    after_save(frm) {\n        var pp=frappe.get_list(\"Item Price\");\n        console.log('kkkkkkkkkkkkkkkkkkkkkk');\n        console.log('999999999999999=============',pp);\n        console.log('itemcode ====',pp[0].item_code);\n        console.log('pricelist====',pp[0].price_list);\n        console.log('pricelist Rate====',pp[0].price_list_rate);\n        console.log('pricelist2===',pp[0].price_list_2);\n        console.log('pricelist3===',pp[0].price_list_3);\n        console.log('pricelist Rate 2===',pp[0].rate_for_price_list_2);\n        console.log('pricelist Rate 3===',pp[0].rate_for_price_list_3);\n        frappe.db.insert({\n            doctype: 'Item Price',\n            item_code:pp[0].item_code,\n            price_list:pp[0].price_list_2,\n            price_list_rate:pp[0].rate_for_price_list_2\n        }).then(function(doc) { \n            console.log(`${doc.doctype} ${doc.name} created on ${doc.creation}`);\n        });\n        frappe.db.insert({\n            doctype: 'Item Price',\n            item_code:pp[0].item_code,\n            price_list:pp[0].price_list_3,\n            price_list_rate:pp[0].rate_for_price_list_3\n        }).then(function(doc) { \n            console.log(`${doc.doctype} ${doc.name} created on ${doc.creation}`);\n        });\n    }   \n});\t",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2021-09-30 20:41:12.627305",
  "name": "Sales Invoice-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Sales Invoice', {\n\trefresh(frm) {\n\t\t// your code here\n\t}\n});\n\nvar r;\nvar i;\nfrappe.ui.form.on('Sales Invoice Item', {\n\trate: function(frm, cdt,cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tconsole.log(\"item\")\n\t\tr=d.rate;\n\t\tfrm.trigger('selling_price_list');\n\t},\n\titem_code: function(frm, cdt,cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tconsole.log(\"item\")\n\t\tvar i=d.item_code;\n\t\tfrm.trigger('batch_no');\n\t\tfrm.refresh_field('items');\n\t},\n\tposa_is_offer:function(frm,cdt,cdn){\n        var d=locals[cdt][cdn];\n        if(d.posa_is_offer==1){\n            frappe.model.set_value(cdt,cdn,\"rate\",0)\n        }\n        if(d.posa_is_offer==0){\n            frappe.model.set_value(cdt,cdn,\"rate\",r)\n        }\n    },\n\tbatch_no:function(frm,cdt,cdn){\n\t    var d=locals[cdt][cdn];\n\t    frappe.call({\n\t        \"method\":\"frappe.client.get\",\n\t        \"args\":{\n\t            \"doctype\":\"Item Price\",\n\t            \"filters\":{\"item_code\":i,\"batch_no\":d.batch_no,\"price_list\":\"Price To Customer - (PTC)\"},\n\t            \"fields\":[\"price_list_rate\"]\n\t        },\n\t        callback:function(r){\n\t            if(r){\n\t                frappe.model.set_value(cdt,cdn,\"ptc\",r.message.price_list_rate)\n\t            }\n\t        }\n\t    })\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Receipt",
  "enabled": 1,
  "modified": "2021-09-30 20:52:37.801762",
  "name": "Purchase Receipt-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Purchase Receipt', {\n\trefresh(frm) {\n\t\t// your code here\n\t}\n});\n\nvar tt;\nvar ii;\nvar bb;\nfrappe.ui.form.on(\"Purchase Receipt Item\",{\n    rate:function(frm,cdt,cdn){\n        var d2=locals[cdt][cdn]\n        if(d2.rate>0){\n            tt=d2.rate;\n            console.log(tt)\n        }\n    },\n    free:function(frm,cdt,cdn){\n        var d=locals[cdt][cdn];\n        if(d.free==1){\n            frappe.model.set_value(cdt,cdn,\"rate\",0)\n        }\n        if(d.free==0){\n            frappe.model.set_value(cdt,cdn,\"rate\",tt)\n        }\n    },\n    discount:function(frm,cdt,cdn){\n        var d1=locals[cdt][cdn];\n        if(d1.discount>0){\n            console.log(\"Discount Entered\")\n            var result=d1.rate-d1.rate*d1.discount/100\n            frappe.model.set_value(cdt,cdn,\"rate\",result)\n        }\n    },\n    item_code:function(frm,cdt,cdn){\n        var d3=locals[cdt][cdn];\n        console.log(d3.item_code)\n        ii=d3.item_code;\n        if(d3.item_code.charAt(0)==\"E\"){\n            var p1=[];\n            console.log(\"External Item Added\",ii)\n            frappe.call({\n                \"method\" : \"frappe.client.get_list\",\n                \"args\" : {\n                    \"doctype\" : \"Item\",\n                    \"filters\" : {\"item_code\":ii},\n                    \"fields\"  :[\"drug_content\"] \n                },\n                callback:function(r){\n                    if(r){\n                        console.log(r)\n                        p1=r.message[0].drug_content\n                        console.log(\"r1r1r1r1r1rr\",p1);\n                        frappe.call({\n                            \"method\":\"frappe.client.get_list\",\n                            \"args\":{\n                                \"doctype\":\"Item\",\n                                \"filters\":{\"drug_content\":p1,\"purchase_type\":\"Internal\"},\n                                \"fields\":[\"item_name\"]\n                            },\n                            callback:function(r1){\n                                console.log(\"Internal Item\",r1)\n                                var neww=r1.message;\n                                var neww2=[];\n                                for( var i=0;i<neww.length;i++){\n                                    console.log(neww[i].item_name)\n                                    var neww1=neww[i].item_name;\n                                    neww2.push(neww1)\n                                }\n                                console.log(\"weeeeeeeeeeeeeeeeeeeeeeeee\",neww2);\n                                frappe.msgprint({\n                                    title:__('Notification'),\n                                    indicator:'green',\n                                    message:__(\"You have similar Product in Storegenrix:\"+neww2)\n                                })\n                            }\n                        })\n                    }\n                }\n            })\n        }\n    },\n    batch_no:function(frm,cdt,cdn){\n        var d6=locals[cdt][cdn];\n        console.log(d6.batch_no)\n        bb=d6.batch_no;\n        frappe.call({\n            \"method\":\"frappe.client.get_list\",\n            \"args\":{\n                \"doctype\":\"Item Price\",\n                \"filters\":{\"item_code\":ii,\"batch_no\":bb},\n                \"fields\":[\"price_list\",\"price_list_rate\"]\n            },\n            callback:function(r){\n                if(r){\n                    if(r.message.length==0){\n                        frappe.model.set_value(cdt,cdn,\"company_buying_rate\",\"None\")\n                        frappe.model.set_value(cdt,cdn,\"price_to_franchise_rate\",\"None\")\n                        frappe.model.set_value(cdt,cdn,\"price_to_customer_rate\",\"None\")\n                    }\n                    console.log(\"baatches item pricee\",r)\n                    for(var i=0;i<r.message.length;i++){\n                        if(r.message[i].price_list==\"Company Buying\"){\n                            frappe.model.set_value(cdt,cdn,\"company_buying_rate\",r.message[i].price_list_rate)\n                        }\n                        if(r.message[i].price_list==\"Price To Franchaisee - (PTF)\"){\n                            frappe.model.set_value(cdt,cdn,\"price_to_franchise_rate\",r.message[i].price_list_rate)\n                        }\n                        if(r.message[i].price_list==\"Price To Customer - (PTC)\"){\n                            frappe.model.set_value(cdt,cdn,\"price_to_customer_rate\",r.message[i].price_list_rate)\n                        }\n                    }\n                }\n            }\n        })\n    },\n    set_prices:function(frm,cdt,cdn){\n        console.log(\"Set Priceeeeeeeeeees\")\n        let d5=new frappe.ui.Dialog({\n            title:\"Set Prices\",\n            fields:[\n                {\n                   label:\"Item Code\",\n                   fieldname:'item',\n                   fieldtype:'Data',\n                },\n                {\n                   label:\"Company Buying Rate\",\n                   fieldname:'c_b_r',\n                   fieldtype:'Data',\n                },\n                {\n                   label:\"Price to Franchise(PTF)\",\n                   fieldname:'ptf',\n                   fieldtype:'Data',\n                },\n                {\n                   label:\"Price to Customer(PTC)\",\n                   fieldname:'ptc',\n                   fieldtype:'Data',\n                },\n                {\n                   label:\"Batch Name\",\n                   fieldname:'batch',\n                   fieldtype:'Data',\n                },\n                ],\n                primary_action_label:\"Add Prices\",\n                primary_action(values){\n                    console.log(values)\n                    frappe.db.insert({\n                        doctype:'Item Price',\n                        item_code:values.item,\n                        price_list:\"Company Buying\",\n                        price_list_rate:values.c_b_r,\n                        batch_no:values.batch\n                    })\n                    frappe.db.insert({\n                        doctype:'Item Price',\n                        item_code:values.item,\n                        price_list:\"Price To Franchaisee - (PTF)\",\n                        price_list_rate:values.ptf,\n                        batch_no:values.batch\n                    })\n                    frappe.db.insert({\n                        doctype:'Item Price',\n                        item_code:values.item,\n                        price_list:\"Price To Customer - (PTC)\",\n                        price_list_rate:values.ptc,\n                        batch_no:values.batch\n                    })\n                    msgprint(\"Prices added successfully\")\n                    d5.hide();\n                }\n        })\n        d5.show();\n        d5.fields_dict.item.set_value(ii);\n        d5.fields_dict.item.refresh();\n        d5.fields_dict.batch.set_value(bb);\n        d5.fields_dict.batch.refresh();\n    }\n});",
  "view": "Form"
 }
]